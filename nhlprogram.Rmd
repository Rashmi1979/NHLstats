---
title: "Project 1"
output:
  github_document    
    
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(httr)
library(jsonlite)
library(bigrquery)
library(tidyverse)


# Franchise Function (get_franchise)
get_franchise <- function(){
  baseURL <- "https://records.nhl.com/site/api"
  franchiseURL <-  paste0(baseURL, "/franchise")
  return (fromJSON(content(GET(franchiseURL), "text"),flatten = TRUE)$data)
}

#Helper function to get ID from Name
get_franchise_id <- function(name){
  baseURL <- "https://records.nhl.com/site/api"
  franchiseURL <-  paste0(baseURL, "/franchise")
  frachiseData <- fromJSON(content(GET(franchiseURL), "text"),flatten = TRUE)$data
  id <- filter(frachiseData, fullName==name)$id
}

# Team Totals function
get_team_totals <- function(){
  baseURL <- "https://records.nhl.com/site/api"
  teamURL <-  paste0(baseURL, "/franchise-team-totals")
  return (fromJSON(content(GET(teamURL), "text"),flatten = TRUE)$data)
}

# Season Records
get_season_records <- function(ID=0, name=NULL){
  
  if(ID ==0 && is.null(name))
    return("Please provide valid ID or name")
  
  baseURL <- "https://records.nhl.com/site/api"
  
  if(ID == 0 && !is.null(name)){
    ID = get_franchise_id(name)
  }
    
  seasonURL <-  paste0(baseURL, "/franchise-season-records?cayenneExp=franchiseId=",ID)
  return (fromJSON(content(GET(seasonURL), "text"),flatten = TRUE)$data)
  
}

# Goalie records
get_goalie_records <- function(ID=0,name=NULL){
  
  if(ID ==0 && is.null(name))
    return("Please provide valid ID or name")
  
  baseURL <- "https://records.nhl.com/site/api"
  
  if(ID == 0 && !is.null(name)){
    ID = get_franchise_id(name)
  }
 
  goalieURL <-  paste0(baseURL, "/franchise-goalie-records?cayenneExp=franchiseId=",ID)
  return (fromJSON(content(GET(goalieURL), "text"),flatten = TRUE)$data)
}

#Skater records
get_skater_records <- function(ID=0, name=NULL){
  if(ID ==0 && is.null(name))
    return("Please provide valid ID or name")
  
  baseURL <- "https://records.nhl.com/site/api"
  
  if(ID == 0 && !is.null(name)){
    ID = get_franchise_id(name)
  }
 
  skaterURL<-paste0(baseURL,"/franchise-skater-records?cayenneExp=franchiseId=",ID)
  return (fromJSON(content(GET(skaterURL), "text"),flatten = TRUE)$data)
}

#Get mos recent Team ID
get_franchise_details<- function(ID=0){

  if(ID ==0)
    return("Please provide valid most recent team id")
  
  baseURL <- "https://records.nhl.com/site/api"
  
  if(ID == 0 && !is.null(name)){
    ID = get_franchise_id(name)
  }
 
  mrtURL<-paste0(baseURL,"/franchise-detail?cayenneExp=mostRecentTeamId=",ID)
  return (fromJSON(content(GET(mrtURL), "text"),flatten = TRUE)$data)
  
}

#Get Team statistics
get_team_stats<- function(teamID=0){
  baseURL <- "https://statsapi.web.nhl.com/api/v1/teams"
  statsURL<-paste0(baseURL,"?expand=team.stats")    
  
  if(teamID > 0){
    statsURL <-paste0(baseURL,"/",teamID,"?expand=team.stats") 
  }
  return (fromJSON(content(GET(statsURL), "text"),flatten = TRUE))
}

```


